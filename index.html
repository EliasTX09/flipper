<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Flipper RPC Debug</title>
  <style>
    body { background:#111; color:#eee; font-family:monospace; padding:20px; }
    #log { background:#222; padding:10px; height:400px; overflow-y:auto; white-space:pre-wrap; }
    button { margin:5px; padding:8px 16px; border:none; border-radius:6px; cursor:pointer; }
    button:hover { opacity:0.8; }
  </style>
</head>
<body>
  <h1>üîç Flipper RPC Debug</h1>
  <button id="btnCheck">Check API</button>
  <button id="btnConnect">Connect</button>
  <button id="btnDisconnect">Disconnect</button>
  <button id="btnReboot">Reboot</button>
  <div id="log"></div>

  <!-- protobuf runtime -->
  <script src="https://unpkg.com/protobufjs/dist/protobuf.min.js"></script>

  <!-- dein RPC-Bundle -->
  <script src="https://raw.githubusercontent.com/EliasTX09/flipper/refs/heads/main/flipper-rpc.js"></script>

  <!-- Mapping damit window.flipper existiert -->
  <script>
    (function(){
      try {
        if (typeof connect !== "undefined") {
          window.flipper = {
            connect: connect,
            disconnect: disconnect,
            write: write,
            read: read,
            closeReader: closeReader,
            commands: typeof commands !== "undefined" ? commands : null,
            emitter: typeof emitter !== "undefined" ? emitter : null
          };
          console.log("‚úÖ window.flipper gesetzt:", window.flipper);
        } else {
          console.error("‚ùå connect() ist nicht definiert im Bundle");
        }
      } catch (err) {
        console.error("‚ùå Fehler beim Mapping window.flipper:", err);
      }
    })();
  </script>

  <!-- Haupt-App -->
  <script>
    const logEl = document.getElementById("log");
    function log(msg) {
      console.log(msg);
      logEl.textContent += "\n" + msg;
      logEl.scrollTop = logEl.scrollHeight;
    }

    log("üì¢ Start: Seite geladen");
    log("üì¢ protobuf vorhanden? " + (typeof window.protobuf !== "undefined"));
    log("üì¢ window.flipper vorhanden? " + (typeof window.flipper !== "undefined"));

    document.getElementById("btnCheck").onclick = () => {
      log("üîé window.flipper Keys: " + JSON.stringify(Object.keys(window.flipper || {})));
    };

    document.getElementById("btnConnect").onclick = async () => {
      try {
        log("‚û°Ô∏è Versuche Connect...");
        await window.flipper.connect();
        log("‚úÖ Verbunden");
      } catch (err) {
        log("‚ùå Fehler bei Connect: " + err);
      }
    };

    document.getElementById("btnDisconnect").onclick = async () => {
      try {
        log("‚û°Ô∏è Versuche Disconnect...");
        await window.flipper.disconnect();
        log("‚úÖ Getrennt");
      } catch (err) {
        log("‚ùå Fehler bei Disconnect: " + err);
      }
    };

    document.getElementById("btnReboot").onclick = async () => {
      try {
        log("‚û°Ô∏è Versuche Reboot...");
        await window.flipper.commands.system.reboot("os");
        log("‚úÖ Reboot gesendet");
      } catch (err) {
        log("‚ùå Fehler beim Reboot: " + err);
      }
    };
  </script>
</body>
</html>
