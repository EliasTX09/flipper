<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Flipper RPC Debug</title>
  <style>
    body { background:#111; color:#eee; font-family:monospace; padding:20px; }
    #log { background:#222; padding:10px; height:400px; overflow-y:auto; white-space:pre-wrap; }
    button { margin:5px; padding:8px 16px; border:none; border-radius:6px; cursor:pointer; }
    button:hover { opacity:0.8; }
  </style>
</head>
<body>
  <h1>üîç Flipper RPC Debug</h1>
  <button id="btnCheck">Check API</button>
  <button id="btnConnect">Connect</button>
  <button id="btnDisconnect">Disconnect</button>
  <button id="btnReboot">Reboot</button>
  <div id="log"></div>

  <!-- protobuf runtime -->
  <script src="https://unpkg.com/protobufjs/dist/protobuf.min.js"></script>

  <!-- dein RPC-Bundle von GitHub Raw -->
  <script src="https://raw.githubusercontent.com/EliasTX09/flipper/refs/heads/main/flipper-rpc.js"></script>

  <script>
    const logEl = document.getElementById("log");
    function log(msg) {
      console.log(msg);
      logEl.textContent += "\n" + msg;
      logEl.scrollTop = logEl.scrollHeight;
    }

    // Check direkt nach Laden
    log("üì¢ Start: Seite geladen");
    log("üì¢ protobuf vorhanden? " + (typeof window.protobuf !== "undefined"));
    log("üì¢ window.flipper vorhanden? " + (typeof window.flipper !== "undefined"));
    log("üì¢ typeof connect: " + (typeof (window.flipper?.connect)));
    log("üì¢ typeof commands: " + (typeof (window.flipper?.commands)));

    // Button: Check API
    document.getElementById("btnCheck").onclick = () => {
      log("üîé window.flipper: " + JSON.stringify(Object.keys(window.flipper || {})));
      log("üîé commands: " + (window.flipper?.commands ? "OK" : "NULL"));
    };

    // Button: Connect
    document.getElementById("btnConnect").onclick = async () => {
      try {
        log("‚û°Ô∏è Versuche Connect...");
        await window.flipper.connect();
        log("‚úÖ Verbunden");
      } catch (err) {
        log("‚ùå Fehler bei Connect: " + err);
      }
    };

    // Button: Disconnect
    document.getElementById("btnDisconnect").onclick = async () => {
      try {
        log("‚û°Ô∏è Versuche Disconnect...");
        await window.flipper.disconnect();
        log("‚úÖ Getrennt");
      } catch (err) {
        log("‚ùå Fehler bei Disconnect: " + err);
      }
    };

    // Button: Reboot
    document.getElementById("btnReboot").onclick = async () => {
      try {
        log("‚û°Ô∏è Versuche Reboot...");
        await window.flipper.commands.system.reboot("os");
        log("‚úÖ Reboot gesendet");
      } catch (err) {
        log("‚ùå Fehler bei Reboot: " + err);
      }
    };

    // Nach 2 Sekunden nochmal automatisch checken
    setTimeout(() => {
      log("‚è± Auto-Check nach 2s: window.flipper=" + (typeof window.flipper));
    }, 2000);
  </script>
</body>
</html>
